{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///Users/dylmw/my-life-script/lib/agent.js"],"sourcesContent":["// /lib/agent.js\n\nexport const SYSTEM_PROMPT = `\nYou are \"ScriptCraft\" — a senior screenwriter, comic/script expert and narrative philosopher.\nYour job: transform a user's diary-style text into a professional, panel-by-panel script\n(or screenplay-style scenes) in the SAME LANGUAGE as the user's input (Hebrew or English).\n\nCORE RULES (must be strictly enforced):\n1) PRESERVE ALL EVENTS: The output MUST include every event and character described in the user's text, in the same chronological order.\n2) NO FACTUAL ALTERATIONS: You MUST NOT invent significant new events.\n3) NAMES: Keep user-provided names.\n4) GENRE ADAPTATION: Adapt tone to the requested genre.\n5) LANGUAGE: Output must be in the user's input language.\n6) FORMAT: Provide a panel/scene structured script.\n7) LENGTH: Aim for 6-10 panels/scenes.\n8) DRAMATIC ENRICHMENT: Add atmosphere and camera notes.\n9) NO UNWANTED ADDITIONS: Keep it grounded.\n10) OUTPUT ONLY: Return only the script text.\n`;\n\nexport function detectLanguage(text) {\n  const hebrew = /[\\u0590-\\u05FF]/;\n  const hasHebrew = hebrew.test(text);\n  const latin = /[A-Za-z]/;\n  const hasLatin = latin.test(text);\n  if (hasHebrew && !hasLatin) return \"he\";\n  if (hasLatin && !hasHebrew) return \"en\";\n  return hasHebrew ? \"he\" : \"en\";\n}\n\nexport function mapGenreToLabel(genre, lang) {\n  const map = {\n    drama: { he: \"דרמה\", en: \"Drama\" },\n    action: { he: \"פעולה\", en: \"Action\" },\n    comedy: { he: \"קומדיה\", en: \"Comedy\" },\n    horror: { he: \"אימה\", en: \"Horror\" },\n    romance: { he: \"רומנטיקה\", en: \"Romance\" },\n    thriller: { he: \"מותחן\", en: \"Thriller\" },\n    comic: { he: \"קומיקס\", en: \"Comic\" },\n    \"sci-fi\": { he: \"מדע בדיוני\", en: \"Sci-Fi\" } // הוספת המפתח החסר עם המקף\n  };\n\n  // מנגנון הגנה: אם הז'אנר לא קיים במפה, נשתמש בדרמה כברירת מחדל\n  const genreData = map[genre] || map.drama;\n  return lang === \"he\" ? genreData.he : genreData.en;\n}\n\nexport function buildComicScriptPrompt(userText, genre) {\n  const lang = detectLanguage(userText);\n  const genreLabel = mapGenreToLabel(genre, lang);\n  const userInstruction = lang === \"he\"\n    ? `להלן טקסט יומן של משתמש. אנא המר/י אותו לתסריט ${genreLabel} מקצועי, מחולק לסצנות/פאנלים. שמור/י על כל האירועים.`\n    : `Here is a user's diary text. Convert it into a professional ${genreLabel} script.`;\n  \n  const messages = [\n    { role: \"system\", content: SYSTEM_PROMPT },\n    { role: \"user\", content: userInstruction },\n    { role: \"user\", content: userText }\n  ];\n  return { messages, lang };\n}"],"names":[],"mappings":"AAAA,gBAAgB;;;;;;;;;;;AAET,MAAM,gBAAgB,CAAC;;;;;;;;;;;;;;;;AAgB9B,CAAC;AAEM,SAAS,eAAe,IAAI;IACjC,MAAM,SAAS;IACf,MAAM,YAAY,OAAO,IAAI,CAAC;IAC9B,MAAM,QAAQ;IACd,MAAM,WAAW,MAAM,IAAI,CAAC;IAC5B,IAAI,aAAa,CAAC,UAAU,OAAO;IACnC,IAAI,YAAY,CAAC,WAAW,OAAO;IACnC,OAAO,YAAY,OAAO;AAC5B;AAEO,SAAS,gBAAgB,KAAK,EAAE,IAAI;IACzC,MAAM,MAAM;QACV,OAAO;YAAE,IAAI;YAAQ,IAAI;QAAQ;QACjC,QAAQ;YAAE,IAAI;YAAS,IAAI;QAAS;QACpC,QAAQ;YAAE,IAAI;YAAU,IAAI;QAAS;QACrC,QAAQ;YAAE,IAAI;YAAQ,IAAI;QAAS;QACnC,SAAS;YAAE,IAAI;YAAY,IAAI;QAAU;QACzC,UAAU;YAAE,IAAI;YAAS,IAAI;QAAW;QACxC,OAAO;YAAE,IAAI;YAAU,IAAI;QAAQ;QACnC,UAAU;YAAE,IAAI;YAAc,IAAI;QAAS,EAAE,2BAA2B;IAC1E;IAEA,+DAA+D;IAC/D,MAAM,YAAY,GAAG,CAAC,MAAM,IAAI,IAAI,KAAK;IACzC,OAAO,SAAS,OAAO,UAAU,EAAE,GAAG,UAAU,EAAE;AACpD;AAEO,SAAS,uBAAuB,QAAQ,EAAE,KAAK;IACpD,MAAM,OAAO,eAAe;IAC5B,MAAM,aAAa,gBAAgB,OAAO;IAC1C,MAAM,kBAAkB,SAAS,OAC7B,CAAC,+CAA+C,EAAE,WAAW,oDAAoD,CAAC,GAClH,CAAC,4DAA4D,EAAE,WAAW,QAAQ,CAAC;IAEvF,MAAM,WAAW;QACf;YAAE,MAAM;YAAU,SAAS;QAAc;QACzC;YAAE,MAAM;YAAQ,SAAS;QAAgB;QACzC;YAAE,MAAM;YAAQ,SAAS;QAAS;KACnC;IACD,OAAO;QAAE;QAAU;IAAK;AAC1B"}},
    {"offset": {"line": 119, "column": 0}, "map": {"version":3,"sources":["file:///Users/dylmw/my-life-script/lib/story-service.js"],"sourcesContent":["// /lib/story-service.js\nimport { buildComicScriptPrompt } from \"./agent.js\"; // הוספנו סיומת .js ו-import\n\nconst MODEL_NAME = process.env.MODEL_NAME ?? \"openai/gpt-4.1\";\nconst OPENROUTER_API_URL = process.env.OPENROUTER_API_URL ?? \"https://openrouter.ai/api/v1/chat/completions\";\nconst OPENROUTER_API_KEY = process.env.OPENROUTER_API_KEY ?? \"\";\n\nasync function callOpenRouter(messages, model = MODEL_NAME) {\n  if (!OPENROUTER_API_KEY) throw new Error(\"OPENROUTER_API_KEY not set in environment\");\n  const body = {\n    model,\n    messages,\n    temperature: 0.7,\n    max_tokens: 1200,\n  };\n  const res = await fetch(OPENROUTER_API_URL, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      \"Authorization\": `Bearer ${OPENROUTER_API_KEY}`,\n    },\n    body: JSON.stringify(body),\n  });\n  if (!res.ok) {\n    const txt = await res.text();\n    throw new Error(`OpenRouter API error: ${res.status} - ${txt}`);\n  }\n  const j = await res.json();\n  const content = j?.choices?.[0]?.message?.content ?? j?.choices?.[0]?.text ?? j?.output?.[0]?.content?.text ?? null;\n  if (!content) throw new Error(\"Could not parse response from OpenRouter\");\n  return content;\n}\n\n// שימוש ב-export מודרני\nexport async function generateScript(userText, genre) {\n  try {\n    const { messages, lang } = buildComicScriptPrompt(userText, genre);\n    const extra = lang === \"he\"\n      ? \"\\n\\nהנחיה נוספת: שאף לתוצאה בת 6-10 פאנלים/סצנות אם הטקסט מאפשר. החזר את טקסט התסריט בלבד - ללא הסברים נוספים.\"\n      : \"\\n\\nExtra instruction: Aim for 6-10 panels/scenes if the text allows. Return the script text only - no extra explanations.\";\n    messages.push({ role: \"user\", content: extra });\n    const output = await callOpenRouter(messages);\n    return { success: true, output };\n  } catch (err) {\n    return { success: false, error: err?.message ?? String(err) };\n  }\n}\n\n// ייצוא המשתנים הנוספים\nexport { MODEL_NAME, OPENROUTER_API_URL, OPENROUTER_API_KEY };"],"names":[],"mappings":";;;;;;;;;;AAAA,wBAAwB;AACxB,kLAAqD,4BAA4B;;AAEjF,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAC7C,MAAM,qBAAqB,QAAQ,GAAG,CAAC,kBAAkB,IAAI;AAC7D,MAAM,qBAAqB,QAAQ,GAAG,CAAC,kBAAkB,IAAI;AAE7D,eAAe,eAAe,QAAQ,EAAE,QAAQ,UAAU;IACxD,IAAI,CAAC,oBAAoB,MAAM,IAAI,MAAM;IACzC,MAAM,OAAO;QACX;QACA;QACA,aAAa;QACb,YAAY;IACd;IACA,MAAM,MAAM,MAAM,MAAM,oBAAoB;QAC1C,QAAQ;QACR,SAAS;YACP,gBAAgB;YAChB,iBAAiB,CAAC,OAAO,EAAE,oBAAoB;QACjD;QACA,MAAM,KAAK,SAAS,CAAC;IACvB;IACA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,MAAM,MAAM,IAAI,IAAI;QAC1B,MAAM,IAAI,MAAM,CAAC,sBAAsB,EAAE,IAAI,MAAM,CAAC,GAAG,EAAE,KAAK;IAChE;IACA,MAAM,IAAI,MAAM,IAAI,IAAI;IACxB,MAAM,UAAU,GAAG,SAAS,CAAC,EAAE,EAAE,SAAS,WAAW,GAAG,SAAS,CAAC,EAAE,EAAE,QAAQ,GAAG,QAAQ,CAAC,EAAE,EAAE,SAAS,QAAQ;IAC/G,IAAI,CAAC,SAAS,MAAM,IAAI,MAAM;IAC9B,OAAO;AACT;AAGO,eAAe,eAAe,QAAQ,EAAE,KAAK;IAClD,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,IAAA,+HAAsB,EAAC,UAAU;QAC5D,MAAM,QAAQ,SAAS,OACnB,mHACA;QACJ,SAAS,IAAI,CAAC;YAAE,MAAM;YAAQ,SAAS;QAAM;QAC7C,MAAM,SAAS,MAAM,eAAe;QACpC,OAAO;YAAE,SAAS;YAAM;QAAO;IACjC,EAAE,OAAO,KAAK;QACZ,OAAO;YAAE,SAAS;YAAO,OAAO,KAAK,WAAW,OAAO;QAAK;IAC9D;AACF"}},
    {"offset": {"line": 185, "column": 0}, "map": {"version":3,"sources":["file:///Users/dylmw/my-life-script/pages/api/generate-script.js"],"sourcesContent":["// pages/api/generate-script.js\nimport { generateScript } from '../../lib/story-service.js';\n\nexport default async function handler(req, res) {\n  if (req.method !== 'POST') {\n    return res.status(405).json({ message: 'Method Not Allowed' });\n  }\n\n  try {\n    const { journalEntry, genre } = req.body;\n\n    if (!journalEntry) {\n      return res.status(400).json({ message: 'Missing journal entry' });\n    }\n\n    const result = await generateScript(journalEntry, genre || 'drama');\n\n    if (!result.success) {\n      throw new Error(result.error);\n    }\n\n    return res.status(200).json({ script: result.output });\n  } catch (error) {\n    console.error(\"API Error:\", error);\n    return res.status(500).json({ message: error.message });\n  }\n}"],"names":[],"mappings":";;;;AAAA,+BAA+B;AAC/B;;AAEe,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,IAAI,IAAI,MAAM,KAAK,QAAQ;QACzB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,SAAS;QAAqB;IAC9D;IAEA,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,KAAK,EAAE,GAAG,IAAI,IAAI;QAExC,IAAI,CAAC,cAAc;YACjB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,SAAS;YAAwB;QACjE;QAEA,MAAM,SAAS,MAAM,IAAA,kIAAc,EAAC,cAAc,SAAS;QAE3D,IAAI,CAAC,OAAO,OAAO,EAAE;YACnB,MAAM,IAAI,MAAM,OAAO,KAAK;QAC9B;QAEA,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,QAAQ,OAAO,MAAM;QAAC;IACtD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,cAAc;QAC5B,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,SAAS,MAAM,OAAO;QAAC;IACvD;AACF"}}]
}